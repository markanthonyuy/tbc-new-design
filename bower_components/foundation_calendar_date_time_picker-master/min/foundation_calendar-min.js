$.fn.fcdp=function(a,e,t){var i=$.type(a);"object"==i?$(this).each(function(){$.fcdp.buildUI($(this),a)}):"string"==i&&$(this).each(function(){$.fcdp.execute($(this),a,e,t)})},$.fcdp={init:function(){$("input[data-date-time]").add($("input[data-date]")).add($("input[data-time]")).each(function(){$.fcdp.buildUI($(this))}),$(document).click(function(a){$(".calendar").not(".fixed").find(".date-picker").hide(),$(".calendar").find(".time-picker").hide()})},getDateFromString:function(a,e){return e=e||!0,a||e?a?new Date.parse(a):new Date:null},moveMonth:function(a,e){return a.add({months:e})},daysInMonth:function(a){return lastDay=new Date(a.getFullYear(),a.getMonth()+1,0),lastDay.getDate()},dateParts:function(a){var e={year:a.getYear(),month:a.getMonth(),day:a.getDate(),hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()};return e.year+=e.year<2e3?1900:0,e},getFieldDate:function(a){var e=a.input.val();return date=a.nullable&&!e?null:a.nullable||e?this.getDateFromString(e):new Date,date},setFieldDate:function(a,e){var t=e?e.format(a.formats.value):"";a.input.val(t),e=e?e.add(a.utcOffset).hours():e,this.setWorkingDate(a,e)},getWorkingDate:function(a){var e=a.input.data("working-date");return e&&0!=(""+e).length?date=this.getDateFromString(e):(date=new Date,this.setWorkingDate(a,date,!0)),date},setWorkingDate:function(a,e){a.input.data("working-date",e?e.format("%Y-%m-%d %H:%M:%S"):"");var t="--",i="--";e&&(t=e.format(a.formats.date),i=e.format(a.formats.time)),a.dateSelector&&a.dateSelector.find(".value").html(t),a.timeSelector&&a.timeSelector.find(".value").html(i)},buildUI:function(a,e){a.wrap('<div class="calendar"></div>'),a.wrap('<div class="hidden"></div>'),a.addClass("value");var t=a.closest(".calendar"),i=$('<div class="selector"></div>');t.append(i);var n=a.is("[data-utc-offset]")?parseInt(a.data("utc-offset")):0;n=isNaN(n)?0:n;var d=a.is("[data-time]")||a.is("[data-date-time]")?!0:!1,l=a.is("[data-date]")||a.is("[data-date-time]")?!0:!d,s={input:a,calendar:t,formats:{date:a.is("[data-date-format]")?a.data("date-format"):"%A: %B %-d, %Y",time:a.is("[data-time-format]")?a.data("time-format"):"%-I:%M %p",value:a.is("[data-value-format]")?a.data("value-format"):"%Y-%m-%d %H:%M:%S"},hasTimePicker:d,hasDatePicker:l,nullable:a.is("[data-nullable]"),utcOffset:n,minDate:a.is("[data-min-date]")?this.getDateFromString(a.data("min-date")):null,maxDate:a.is("[data-max-date]")?this.getDateFromString(a.data("max-date")):null,fixed:a.is("[data-fixed]")?!0:!1};if(e=e?$.extend({},s,e):s,e.fixed&&t.addClass("fixed"),e.hasDatePicker){if(!e.fixed){var r=$('<a class="date-selector"></a>');r.append('<i class="fi-calendar"></i><span class="value"></span>'),i.append(r),i.addClass("date")}var o=$('<div class="date-picker"></div>');t.append(o),o.click(function(a){a.stopPropagation()})}if(e.hasTimePicker&&!e.fixed){var c=$('<a class="time-selector"></a>');c.append('<i class="icon-calendar"></i><span class="value"></span>'),i.append(c),i.addClass("time");var p=$('<div class="time-picker"></div>');t.append(p),p.click(function(a){a.stopPropagation()})}if(e.nullable){var u=$('<a class="clear"><i class="fi-x"></i></a>');i.append(u)}i.click(function(a){a.stopPropagation()}),e=$.extend(e,{dateSelector:l?t.find(".date-selector"):null,datePicker:l?t.find(".date-picker"):null,timeSelector:d?i.find(".time-selector"):null,timePicker:d?t.find(".time-picker"):null,clearButton:e.nullable?t.find("a.clear"):null}),t.data("opts",e),a.data("opts",e),e.dateSelector&&e.dateSelector.click(function(a){a.preventDefault();var e=$(this).closest(".calendar"),t=e.find(".time-picker"),i=e.find(".date-picker"),n=e.find(".date-selector");i.css({top:n.position().top+n.outerHeight(),left:n.position().left}),t.hide(),i.toggle()}),e.timeSelector&&t.find("a.time-selector").click(function(a){a.preventDefault();var e=$(this).closest(".calendar"),t=e.find(".date-picker"),i=e.find(".time-picker"),n=e.find(".time-selector");i.css({top:n.position().top+n.outerHeight(),right:n.position().right}),t.hide(),i.toggle()}),e.clearButton&&e.clearButton.click(function(a){a.preventDefault();var e=$(this).closest(".calendar").data("opts");e.datePicker.add(e.timePicker).hide(),$.fcdp.setFieldDate(e,null)}),this.setFieldDate(e,this.getFieldDate(e)),this.buildCalendar(e),this.buildTime(e),this.updateTimePicker(e),null==this.getFieldDate(e)&&$.fcdp.setWorkingDate(e,null)},buildTime:function(a){if(tp=a.timePicker){var e=$('<div class="header"></div>'),t=$('<div class="time">Time</div>');e.append(t),tp.append(e);var i=$('<div class="time"></div>'),n=$('<div class="value-control hour"><label>Hr</label><a class="value-change up"><span></span></a><input type="text" class="display" value="12" /><a class="value-change down"><span></span></a></div>'),d=$('<div class="value-control minute"><label>Min</label><a class="value-change up"><span></span></a><input type="text" class="display" value="00" /><a class="value-change down"><span></span></a></div>'),l=$('<div class="value-control second"><label>Sec</label><a class="value-change up"><span></span></a><input type="text" class="display" value="00" /><a class="value-change down"><span></span></a></div>'),s=$('<div class="value-control ampm"><label>A/P</label><a class="value-change up"><span></span></a><input type="text" class="display" value="AM" /><a class="value-change down"><span></span></a></div>');i.append(n),i.append(d),i.append(l),i.append(s),tp.append(i),this.wireupTime(a)}},wireupTime:function(a){if(tp=a.timePicker){var e=tp.find(".value-control.hour");this.wireupTimeValueControl(e,1,12,1);var t=tp.find(".value-control.minute");this.wireupTimeValueControl(t,0,59,2);var i=tp.find(".value-control.second");this.wireupTimeValueControl(i,0,59,2);var n=tp.find(".value-control.ampm");this.wireupTimeAmPmControl(n)}},wireupTimeAmPmControl:function(a){a.find(".value-change").click(function(a){a.preventDefault();var e=$(this),t=e.closest(".value-control"),i=t.find("input.display").val().toLowerCase();i="am"==i?"PM":"AM",t.find("input.display").val(i),$.fcdp.updateTime(e.closest(".calendar").data("opts"))}),a.find("input.display").change(function(a){var e=$(this),t=e.closest(".value-control"),i=t.find("input.display").val().toLowerCase()[0];i="p"==i?"PM":"AM",t.find("input.display").val(i),$.fcdp.updateTime(e.closest(".calendar").data("opts"))})},wireupTimeValueControl:function(a,e,t,i){a.data("opts",{max:t,min:e,pad:i}),a.find(".value-change.up").click(function(a){a.preventDefault();var e=$(this),t=e.closest(".value-control"),n=t.data("opts"),d=parseInt(t.find("input.display").val());d+=1,d=d>n.max?n.min:d,t.find("input.display").val((""+d).lpad(i));var l=e.closest(".calendar").data("opts");$.fcdp.updateTime(l)}),a.find(".value-change.down").click(function(a){a.preventDefault();var e=$(this),t=e.closest(".value-control"),n=t.data("opts"),d=parseInt(t.find("input.display").val());d-=1,d=d<n.min?n.max:d,t.find("input.display").val((""+d).lpad(i));var l=e.closest(".calendar").data("opts");$.fcdp.updateTime(l)}),a.find("input.display").change(function(a){var e=$(this),t=e.closest(".value-control"),n=t.data("opts"),d=parseInt(t.find("input.display").val());d=isNaN(d)?n.min:d>n.max?n.max:d<n.min?n.min:d,t.find("input.display").val((""+d).lpad(i));var l=e.closest(".calendar").data("opts");$.fcdp.updateTime(l)})},updateTimePicker:function(a){var e;if(e=a.timePicker){var t=this.getWorkingDate(a);t&&(e.find(".value-control.hour").find("input.display").val(t.format("%-I")),e.find(".value-control.minute").find("input.display").val(t.format("%M")),e.find(".value-control.second").find("input.display").val(t.format("%S")),e.find(".value-control.ampm").find("input.display").val(t.format("%p")))}},updateTime:function(a){var e;if(e=a.timePicker){var t=e.find(".value-control.hour").find("input.display").val();t=t?parseInt(t):0;var i=e.find(".value-control.minute").find("input.display").val();i=i?parseInt(i):0;var n=parseInt(e.find(".value-control.second").find("input.display").val());n=n?parseInt(n):0;var d=e.find(".value-control.ampm").find("input.display").val();t=12==t?0:t,"pm"===d.toLowerCase()&&(t+=12),t%=24;var l=this.getWorkingDate(a),s=new Date(l.getFullYear(),l.getMonth(),l.getDate(),t,i,n);s=s?s.add(-a.utcOffset).hours():s,this.setFieldDate(a,s),a.input.trigger("timeChange",[a])}},buildCalendar:function(a){var e;if(e=a.datePicker){e.empty();var t=this.getWorkingDate(a),i=this.getFieldDate(a);i=i?i:new Date;var n=this.dateParts(t),d=0,l=new Date(n.year,n.month,1).getDay(),s=this.daysInMonth(t)+l,r=$('<div class="week"></div>'),o=this.moveMonth(this.getWorkingDate(a),-1),c=this.daysInMonth(o),p=$('<div class="header"></div>');p.append('<a href="#" class="month-nav prev"><span></span</a>'),p.append('<a href="#" class="month-nav next"><span></span></a>'),p.append('<div class="month">'+t.format("%B %Y")+"</div>"),e.append(p);var u=$('<div class="week labels"></div>');for(d=0;7>d;d++){var f=["Su","Mo","Tu","We","Th","Fr","Sa"];u.append('<div class="day">'+f[d]+"</div>")}for(e.append(u),d=0;42>d;d++){var v=d%7,m={date:null,weekday_num:v,is_weekend:0==v||6==v,is_current:!1,day_number:0};l>d||d>=s?(l>d?m.day_number=c-(l-1)+d:d>=s&&(m.day_number=d-s+1),r.append(this.buildOtherMonthDayUI(a,m))):(m.day_number=d-l+1,m.date=new Date(n.year,n.month,m.day_number,n.hour,n.minute,n.second),m.is_current=i.format("%Y%m%d")==m.date.format("%Y%m%d"),r.append(this.buildDayUI(a,m))),6==v&&(e.append(r),r=$('<div class="week"></div>'))}this.wireupCalendar(a)}},buildOtherMonthDayUI:function(a,e){var t=this.executeBehavior("buildOtherMonthDayUI",a,e);if(!t){var i="day other-month"+(e.is_weekend?" weekend":"");t='<div class="'+i+'">'+e.day_number+"</div>"}return t},buildDayUI:function(a,e){e.is_clickable=this.dateIsClickable(a,e);var t=e.date.getDate(),i=this.executeBehavior("buildDayUI",a,e);if(!i){var n="day"+(e.is_weekend?" weekend":"")+(e.is_current?" current":"");i=e.is_clickable?'<a href="#'+t+'" class="'+n+'" data-date="'+e.date.format()+'">'+t+"</a>":'<span class="'+n+'" data-date="'+e.date.format()+'">'+t+"</span>"}return i},dateIsClickable:function(a,e){if(a.minDate&&e.date<a.minDate||a.maxDate&&e.date>a.maxDate)return!1;var t=this.executeBehavior("dateIsClickable",a,e);return t=null===t?!0:t},wireupCalendar:function(a){var e;(e=a.datePicker)&&(e.find("a.month-nav.prev").click(function(a){a.preventDefault();var e=$(this).closest(".calendar").data("opts"),t=$.fcdp.moveMonth($.fcdp.getWorkingDate(e),-1);$.fcdp.setWorkingDate(e,t),$.fcdp.buildCalendar(e),e.input.trigger("monthChange",[e]),e.input.trigger("monthPrev",[e])}),e.find("a.month-nav.next").click(function(a){a.preventDefault();var e=$(this).closest(".calendar").data("opts"),t=$.fcdp.moveMonth($.fcdp.getWorkingDate(e),1);$.fcdp.setWorkingDate(e,t),$.fcdp.buildCalendar(e),e.input.trigger("monthChange",[e]),e.input.trigger("monthNext",[e])}),e.find("a.day").click(function(a){var e=$(this),t=e.closest(".calendar").data("opts"),i=t.datePicker;i.find("a.current").removeClass("current"),e.addClass("current");var n=$.fcdp.getDateFromString(e.attr("data-date")),d=$.fcdp.getFieldDate(t)||$.fcdp.getWorkingDate(t),l=new Date(n.getFullYear(),n.getMonth(),n.getDate(),d.getHours(),d.getMinutes(),d.getSeconds());$.fcdp.setFieldDate(t,l),t.input.trigger("dateChange",[t])}))},execute:function(a,e,t,i){switch(e){case"bindBehavior":this.bindBehavior(a,t,i)}},bindBehavior:function(a,e,t){if($.isFunction(t)){var i=a.data("behaviors");i=i||{},i[e]=i[e]||[],i[e].push(t),a.data("behaviors",i)}},executeBehavior:function(a,e,t){var i=null,n=e.input.data("behaviors");return n&&n[a]&&$.each(n[a],function(){$.isFunction(this)&&(i=this(e,t,i))}),i}},$(document).ready(function(){$.fcdp.init()});